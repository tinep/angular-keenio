!function(e){e.module("angular-keenio.config",[]).value("angular-keenio.config",{debug:!0}),e.module("angular-keenio.directives",[]),e.module("angular-keenio.services",[]),e.module("angular-keenio",["angular-keenio.config","angular-keenio.directives","angular-keenio.services"])}(angular),function(e){e.module("angular-keenio.directives").directive("tbkKeenAreachart",["fetchDeepObject",function(){var e={scope:{query:"=",title:"@",width:"@",height:"@",isStacked:"@",chartOptions:"=?",colors:"=?",labels:"=?",colorMapping:"=?",labelMapping:"=?",colorMappingProperty:"@",labelMappingProperty:"@"},controller:["$scope",function(e){e.chartOptions=e.chartOptions||{chartArea:{height:"85%",left:"5%",top:"5%",width:"80%"},isStacked:!!e.isStacked}}],template:'<div data-tbk-keen-chart="areachart"  query="query"  height="{{height}}"  width="{{width}}"  chart-options="chartOptions"  colors="colors"  labels="labels"  color-mapping="colorMapping"  label-Mapping="labelMapping"  color-mapping-property="{{colorMappingProperty}}"  label-Mapping-property="{{labelMappingProperty}}" ></div>'};return e}])}(angular),function(e){e.module("angular-keenio.directives").directive("tbkKeenBarchart",[function(){var e={scope:{query:"=",title:"@",width:"@",height:"@",isStacked:"@",groupWidth:"@",chartOptions:"=?",colors:"=?",labels:"=?",colorMapping:"=?",labelMapping:"=?",colorMappingProperty:"@",labelMappingProperty:"@"},controller:["$scope",function(e){e.chartOptions=e.chartOptions||{chartArea:{height:"85%",left:"5%",top:"5%",width:"100%"},bar:{groupWidth:e.groupWidth||"85%"},isStacked:!!e.isStacked}}],template:'<div data-tbk-keen-chart="barchart"  query="query"  height="{{height}}"  width="{{width}}"  chart-options="chartOptions"  colors="colors"  labels="labels"  color-mapping="colorMapping"  label-Mapping="labelMapping"  color-mapping-property="{{colorMappingProperty}}"  label-Mapping-property="{{labelMappingProperty}}" ></div>'};return e}])}(angular),function(e){e.module("angular-keenio.directives").directive("tbkKeenChart",["fetchDeepObject",function(t){var r={scope:{chartType:"@tbkKeenChart",query:"=",title:"@",width:"@",height:"@",chartOptions:"=?",colors:"=?",labels:"=?",colorMapping:"=?",labelMapping:"=?",colorMappingProperty:"@",labelMappingProperty:"@"},controller:["$scope","tbkKeenClient",function(r,o){r.keenClient=o,r.height=r.height||250,r.width=r.width||"auto",r.title=r.title||!1,r.chartOptions=r.chartOptions||{chartArea:{height:"85%",left:"5%",top:"5%",width:"80%"}};var n=e.copy(r.labelMapping),i=e.copy(r.colorMapping);e.isUndefined(r.labelMappingProperty)||(e.forEach(n,function(e,o){n[o]=t(e,r.labelMappingProperty)}),r.labelMapping=n),e.isUndefined(r.colorMappingProperty)||(e.forEach(i,function(o,n){if(e.isUndefined(r.labelMappingProperty))i[n]=t(o,r.colorMappingProperty);else{var a=t(o,r.labelMappingProperty);i[a]=t(o,r.colorMappingProperty)}}),r.colorMapping=i)}],link:function(e,t){e.$watch("query",function(r){r&&e.keenClient.then(function(r){r.draw(e.query,t[0],{chartType:e.chartType,title:e.title,height:e.height,width:e.width,chartOptions:e.chartOptions,colors:e.colors,labels:e.labels,colorMapping:e.colorMapping,labelMapping:e.labelMapping})})})}};return r}])}(angular),function(e){e.module("angular-keenio.directives").directive("tbkKeenColumnchart",[function(){var e={scope:{query:"=",title:"@",width:"@",height:"@",isStacked:"@",groupWidth:"@",chartOptions:"=?",colors:"=?",labels:"=?",colorMapping:"=?",labelMapping:"=?",colorMappingProperty:"@",labelMappingProperty:"@"},controller:["$scope",function(e){e.chartOptions=e.chartOptions||{chartArea:{height:"85%",left:"5%",top:"5%",width:"100%"},bar:{groupWidth:e.groupWidth||"85%"},isStacked:!!e.isStacked}}],template:'<div data-tbk-keen-chart="columnchart"  query="query"  height="{{height}}"  width="{{width}}"  chart-options="chartOptions"  colors="colors"  labels="labels"  color-mapping="colorMapping"  label-Mapping="labelMapping"  color-mapping-property="{{colorMappingProperty}}"  label-Mapping-property="{{labelMappingProperty}}" ></div>'};return e}])}(angular),function(e){e.module("angular-keenio.directives").directive("tbkKeenLinechart",[function(){var e={scope:{query:"=",title:"@",width:"@",height:"@",isStacked:"@",groupWidth:"@",chartOptions:"=?",colors:"=?",labels:"=?",colorMapping:"=?",labelMapping:"=?",colorMappingProperty:"@",labelMappingProperty:"@"},controller:["$scope",function(e){e.chartOptions=e.chartOptions||{chartArea:{height:"85%",left:"5%",top:"5%",width:"100%"},bar:{groupWidth:e.groupWidth||"85%"},isStacked:!!e.isStacked}}],template:'<div data-tbk-keen-chart="linechart"  query="query"  height="{{height}}"  width="{{width}}"  chart-options="chartOptions"  colors="colors"  labels="labels"  color-mapping="colorMapping"  label-Mapping="labelMapping"  color-mapping-property="{{colorMappingProperty}}"  label-Mapping-property="{{labelMappingProperty}}" ></div>'};return e}])}(angular),function(e){e.module("angular-keenio.directives").directive("tbkKeenMetric",[function(){var e={scope:{query:"=",title:"@",width:"@",height:"@",chartOptions:"=?",colors:"=?"},controller:["$scope",function(e){e.colors=e.colors||[]}],template:'<div data-tbk-keen-chart="metric"  title="{{title}}"  query="query"  height="{{height}}"  width="{{width}}"  chart-options="chartOptions"  colors="colors" ></div>'};return e}])}(angular),function(e){e.module("angular-keenio.directives").directive("tbkKeenPiechart",[function(){var e={scope:{query:"=",title:"@",width:"@",height:"@",pieHole:"@",chartOptions:"=?",colors:"=?",labels:"=?",colorMapping:"=?",labelMapping:"=?",colorMappingProperty:"@",labelMappingProperty:"@"},controller:["$scope",function(e){e.chartOptions=e.chartOptions||{chartArea:{height:"85%",left:"5%",top:"5%",width:"100%"},pieHole:e.pieHole||.4}}],template:'<div data-tbk-keen-chart="piechart"  query="query"  height="{{height}}"  width="{{width}}"  chart-options="chartOptions"  colors="colors"  labels="labels"  color-mapping="colorMapping"  label-Mapping="labelMapping"  color-mapping-property="{{colorMappingProperty}}"  label-Mapping-property="{{labelMappingProperty}}" ></div>'};return e}]).directive("tbkKeenDefaultPiechart",[function(){var e={scope:{analysisType:"@",eventCollection:"@",groupBy:"@",queryOptions:"=?",chartOptions:"=?",title:"@",width:"@",height:"@",colors:"=?",labels:"=?",colorMapping:"=?",labelMapping:"=?"},controller:["$scope","tbkKeen",function(e,t){e.analysisType=e.analysisType||"count",e.height=e.height||"250",e.width=e.width||"auto",e.queryOptions=e.queryOptions,e.queryOptions.eventCollection=e.eventCollection,e.queryOptions.groupBy=e.groupBy,e.query=new t.Query(e.analysisType,e.queryOptions),e.chartOptions=e.chartOptions||{chartArea:{height:"85%",left:"5%",top:"5%",width:"100%"},pieHole:.4}}],template:'<div data-tbk-keen-piechart  query="query"  height="{{height}}"  width="{{width}}"  title="{{title}}"  chart-options="chartOptions"  colors="colors"  labels="labels"  color-mapping="colorMapping"  label-Mapping="labelMapping" ></div>'};return e}])}(angular),function(e){e.module("angular-keenio.directives").directive("tbkKeenRawMetric",["$injector","$filter","tbkKeenClient",function(e,t,r){var o=function(e){var t=e.containerClass||"tbk-keen-metric";return{container:t,loading:e.loadingClass||t+"-loading",error:e.errorClass||t+"-error",success:e.successClass||t+"-success"}},n=function(e){return{prefix:e.prefix||"",postfix:e.postfix||"",loading:e.loadingText||"Loading...",error:e.errorText||"An error occured!"}},i=function(t){var r=t.filter&&e.has(t.filter+"Filter");return{scale:parseInt(t.scale,10)||0,factor:parseFloat(t.factor)||1,filter:r?t.filter:null,useFilter:r}},a={scope:{query:"=",prefix:"@",postfix:"@",scale:"@",factor:"@",filter:"@",loadingText:"@",errorText:"@",containerClass:"@",loadingClass:"@",successClass:"@",errorClass:"@"},controller:["$scope",function(e){e.texts=n(e),e.classes=o(e),e.options=i(e),e.flags={loading:!1,error:!1},e.response=null}],link:function(e,o){o.addClass(e.classes.container);var n=function(){e.result=null,e.response=null,e.error=null,e.flags.loading=!0,e.flags.error=!1,o.addClass(e.classes.loading),o.removeClass(e.classes.success),o.removeClass(e.classes.error)};!function(){n(),r.run(e.query,function(r,n){if(e.response=n,e.error=r,e.flags.error=!!r,e.flags.loading=!1,!r){var i=n.result*e.options.factor;e.result=e.options.useFilter?t(e.options.filter)(i,e.options.scale):t("number")(i,e.options.scale)}o.removeClass(e.classes.loading),o.addClass(r?e.classes.error:e.classes.success),e.$digest()})}()},template:'<span><span data-ng-hide="flags.loading || flags.error">{{ texts.prefix }}{{ result }}{{ texts.postfix }}</span><span data-ng-show="flags.loading">{{ texts.loading }}</span><span data-ng-show="flags.error">{{ texts.error }}</span></span>'};return a}]).directive("tbkKeenDefaultRawMetric",["$injector","$filter","tbkKeenClient",function(){var e={scope:{analysisType:"@",targetProperty:"@",eventCollection:"@",queryOptions:"=?",prefix:"@",postfix:"@",scale:"@",factor:"@",filter:"@",loadingText:"@",errorText:"@",containerClass:"@",loadingClass:"@",successClass:"@",errorClass:"@"},controller:["$scope","tbkKeen",function(e,t){var r=e.queryOptions||{};r.eventCollection=e.eventCollection,r.targetProperty=e.targetProperty,e.query=new t.Query(e.analysisType,r)}],template:'<span data-tbk-keen-raw-metric  data-query="query"  data-prefix="{{prefix}}"  data-postfix="{{postfix}}"  data-scale="{{scale}}"  data-factor="{{factor}}"  data-filter="{{filter}}"  data-loading-text="{{loadingText}}"  data-error-text="{{errorText}}"  data-container-class="{{containerClass}}"  data-loading-class="{{loadingClass}}"  data-success-class="{{successClass}}"  data-error-class="{{errorClass}}" ></span>'};return e}])}(angular),function(e){e.module("angular-keenio.directives").directive("tbkKeenTable",["tbkKeenClient",function(e){var t={scope:{query:"=",title:"@",height:"@"},controller:["$scope",function(e){e.options={title:e.title||"",height:e.height||340}}],link:function(t,r){e.draw(t.query,r[0],{chartType:"table",title:t.options.title,height:t.options.height})},template:"<div></div>"};return t}]).directive("tbkKeenDefaultTable",[function(){var e={scope:{title:"@",analysisType:"@",eventCollection:"@",queryOptions:"=?"},controller:["$scope","tbkKeen",function(e,t){var r=e.queryOptions||{};r.eventCollection=e.eventCollection,e.analysisType=e.analysisType||"extraction",e.query=new t.Query(e.analysisType,r)}],template:'<div tbk-keen-table  data-query="query"  data-title="{{title}}"></div>'};return e}])}(angular),function(e){e.module("angular-keenio.services").value("tbkKeenDefaultConfig",{projectId:"YOUR_PROJECT_ID",writeKey:"YOUR_WRITE_KEY",readKey:"YOUR_READ_KEY",masterKey:"YOUR_MASTER_KEY",protocol:"https",host:"api.keen.io/3.0",requestType:"jsonp"}).provider("tbkKeenConfig",[function(){var t={};this.projectId=function(e){return t.projectId=e,this},this.writeKey=function(e){return t.writeKey=e,this},this.readKey=function(e){return t.readKey=e,this},this.masterKey=function(e){return t.masterKey=e,this},this.protocol=function(e){return t.protocol=e,this},this.host=function(e){return t.host=e,this},this.requestType=function(e){return t.requestType=e,this},this.$get=["tbkKeenDefaultConfig",function(r){return e.extend(r,t)}]}]).factory("tbkKeen",["$window","$timeout","$q",function(e,t,r){var o=r.defer(),n=function(){e.Keen?t(function(){o.resolve(e.Keen)},0):t(function(){return n()},100)};return n(),o.promise}]).factory("tbkKeenClient",["tbkKeen","tbkKeenConfig",function(e,t){return e.then(function(e){return new e(t)})}]).factory("tbkKeenHttpGet",["tbkKeenConfig","tbkKeenClient",function(e,t){return function(r,o,n){var i=r.replace("<project_id>",e.projectId),a=e.protocol+"://"+e.host+i;return t.get(a,o,e.readKey,n)}}]).factory("angularKeenClient",["tbkKeen","tbkKeenConfig","$q",function(e,t,r){function o(o,n){return e.then(function(e){var i=new e(t),a=r.defer();return i.addEvent(o,n,function(e,t){e?a.reject(e):a.resolve(t)}),a.promise})}function n(o){return e.then(function(e){var n=new e(t),i=r.defer();return n.addEvents(o,function(e,t){e?i.reject(e):i.resolve(t)}),i.promise})}function i(t,r){return e.then(function(e){return new e.Query(t,r)})}function a(o){return e.then(function(e){var n=new e(t),i=r.defer();return n.run(o,function(e,t){e?i.reject(e):i.resolve(t)}),i.promise})}function l(r,o,n){return e.then(function(e){var i=new e(t);i.draw(r,o,n)})}function p(){var e="<protocol>://<host>/projects/<project_id>/events".replace("<protocol>",t.protocol).replace("<host>",t.host).replace("<project_id>",t.projectId);return h(e)}function c(e){var r="<protocol>://<host>/projects/<project_id>/events/<collection>".replace("<protocol>",t.protocol).replace("<host>",t.host).replace("<project_id>",t.projectId).replace("<collection>",e);return h(r)}function s(e){var r="<protocol>://<host>/projects/<project_id>/events/<collection>/properties".replace("<protocol>",t.protocol).replace("<host>",t.host).replace("<project_id>",t.projectId).replace("<collection>",e);return h(r)}function u(e,r){var o="<protocol>://<host>/projects/<project_id>/events/<collection>/properties/<property>".replace("<protocol>",t.protocol).replace("<host>",t.host).replace("<project_id>",t.projectId).replace("<collection>",e).replace("<property>",r);return h(o)}function h(o){return e.then(function(e){var n=new e(t),i=r.defer();return n.get(o,null,n.masterKey(),function(e,t){e?i.reject(e):i.resolve(t)}),i.promise})}return{addEvent:o,addEvents:n,Query:i,run:a,draw:l,collections:p,collection:c,properties:s,property:u}}]).factory("fetchDeepObject",[function(){return function(e,t){if("undefined"==typeof e)return!1;var r=t.indexOf(".");return r>-1?fetchFromObject(e[t.substring(0,r)],t.substr(r+1)):e[t]}}])}(angular);